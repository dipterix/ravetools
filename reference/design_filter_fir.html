<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Design 'FIR' filter using firls — design_filter_fir • ravetools</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Design 'FIR' filter using firls — design_filter_fir"><meta name="description" content="Design 'FIR' filter using firls"><meta property="og:description" content="Design 'FIR' filter using firls"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ravetools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.2.9008</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dipterix/ravetools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Design <code>'FIR'</code> filter using <code><a href="firls.html">firls</a></code></h1>
      <small class="dont-index">Source: <a href="https://github.com/dipterix/ravetools/blob/master/R/filter-fir-design.R" class="external-link"><code>R/filter-fir-design.R</code></a></small>
      <div class="d-none name"><code>design_filter_fir.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Design <code>'FIR'</code> filter using <code><a href="firls.html">firls</a></code></p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">design_filter_fir</span><span class="op">(</span></span>
<span>  <span class="va">sample_rate</span>,</span>
<span>  filter_order <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  data_size <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  high_pass_freq <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  high_pass_trans_freq <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  low_pass_freq <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  low_pass_trans_freq <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  stopband_attenuation <span class="op">=</span> <span class="fl">40</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"kaiser"</span>, <span class="st">"firls"</span>, <span class="st">"remez"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-sample-rate">sample_rate<a class="anchor" aria-label="anchor" href="#arg-sample-rate"></a></dt>
<dd><p>sampling frequency</p></dd>


<dt id="arg-filter-order">filter_order<a class="anchor" aria-label="anchor" href="#arg-filter-order"></a></dt>
<dd><p>filter order, leave <code>NA</code> (default) if undecided</p></dd>


<dt id="arg-data-size">data_size<a class="anchor" aria-label="anchor" href="#arg-data-size"></a></dt>
<dd><p>minimum length of data to apply the filter, used to
decide the maximum filter order. For 'FIR' filter, data length must be
greater than <code>3xfilter_order</code></p></dd>


<dt id="arg-high-pass-freq">high_pass_freq<a class="anchor" aria-label="anchor" href="#arg-high-pass-freq"></a></dt>
<dd><p>high-pass frequency; default is <code>NA</code> (no
high-pass filter will be applied)</p></dd>


<dt id="arg-high-pass-trans-freq">high_pass_trans_freq<a class="anchor" aria-label="anchor" href="#arg-high-pass-trans-freq"></a></dt>
<dd><p>high-pass frequency band-width; default
is automatically inferred from data size.
Frequency <code>high_pass_freq - high_pass_trans_freq</code> is the corner
of the stop-band</p></dd>


<dt id="arg-low-pass-freq">low_pass_freq<a class="anchor" aria-label="anchor" href="#arg-low-pass-freq"></a></dt>
<dd><p>low-pass frequency; default is <code>NA</code> (no
low-pass filter will be applied)</p></dd>


<dt id="arg-low-pass-trans-freq">low_pass_trans_freq<a class="anchor" aria-label="anchor" href="#arg-low-pass-trans-freq"></a></dt>
<dd><p>low-pass frequency band-width; default
is automatically inferred from data size.
Frequency <code>low_pass_freq + low_pass_trans_freq</code> is the corner
of the stop-band</p></dd>


<dt id="arg-stopband-attenuation">stopband_attenuation<a class="anchor" aria-label="anchor" href="#arg-stopband-attenuation"></a></dt>
<dd><p>allowable power attenuation (in decibel) at
transition frequency; default is <code>40</code> dB.</p></dd>


<dt id="arg-scale">scale<a class="anchor" aria-label="anchor" href="#arg-scale"></a></dt>
<dd><p>whether to scale the filter for unity gain</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>method to generate 'FIR' filter, default is using
<code><a href="https://rdrr.io/pkg/gsignal/man/kaiser.html" class="external-link">kaiser</a></code> estimate, other choices are
<code><a href="firls.html">firls</a></code> (with <code>hamming</code> window) and
<code><a href="https://rdrr.io/pkg/gsignal/man/remez.html" class="external-link">remez</a></code> design.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>'FIR' filter in 'Arma' form.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Filter type is determined from <code>high_pass_freq</code> and
<code>low_pass_freq</code>. High-pass frequency is ignored if <code>high_pass_freq</code>
is <code>NA</code>, hence the filter is low-pass filter. When
<code>low_pass_freq</code> is <code>NA</code>, then
the filter is high-pass filter. When both <code>high_pass_freq</code> and
<code>low_pass_freq</code> are valid (positive, less than 'Nyquist'), then
the filter is a band-pass filter if band-pass is less than low-pass
frequency, otherwise the filter is band-stop.</p>
<p>Although the peak amplitudes are set at 1 by <code>low_pass_freq</code> and
<code>high_pass_freq</code>, the transition from peak amplitude to zero require
a transition, which is tricky but also important to set.
When 'FIR' filters have too steep transition boundaries, the filter tends to
have ripples in peak amplitude, introducing artifacts to the final signals.
When the filter is too flat, components from unwanted frequencies may also
get aliased into the filtered signals. Ideally, the transition bandwidth
cannot be too steep nor too flat. In this function, users may control
the transition frequency bandwidths via <code>low_pass_trans_freq</code> and
<code>high_pass_trans_freq</code>. The power at the end of transition is defined
by <code>stopband_attenuation</code>, with default value of <code>40</code> (i.e.
-40 dB, this number is automatically negated during the calculation).
By design, a low-pass 5 Hz filter with 1 Hz transition bandwidth results in
around -40 dB power at 6 Hz.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ---- Basic -----------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sample_rate</span> <span class="op">&lt;-</span> <span class="fl">500</span></span></span>
<span class="r-in"><span><span class="va">data_size</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># low-pass at 5 Hz, with auto transition bandwidth</span></span></span>
<span class="r-in"><span><span class="co"># from kaiser's method, with default stopband attenuation = 40 dB</span></span></span>
<span class="r-in"><span><span class="va">filter</span> <span class="op">&lt;-</span> <span class="fu">design_filter_fir</span><span class="op">(</span></span></span>
<span class="r-in"><span>  low_pass_freq <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>  sample_rate <span class="op">=</span> <span class="va">sample_rate</span>,</span></span>
<span class="r-in"><span>  data_size <span class="op">=</span> <span class="va">data_size</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Passband ripple is around 0.08 dB</span></span></span>
<span class="r-in"><span><span class="co"># stopband attenuation is around 40 dB</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">filter</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;FIR filter&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Type : low</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Method: kaiser</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Order: 332</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Magnitude:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Freq=5 Hz, mag=-0.1005 dB (expected=-0.0873 dB)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Freq=8.4 Hz, mag=-40.92 dB (expected=-40 dB)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Reciprocal condition number: 1 &gt; .Machine$double.eps</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="diagnose_filter.html">diagnose_filter</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">filter</span><span class="op">$</span><span class="va">b</span>, <span class="va">filter</span><span class="op">$</span><span class="va">a</span>,</span></span>
<span class="r-in"><span>  fs <span class="op">=</span> <span class="va">sample_rate</span>,</span></span>
<span class="r-in"><span>  n <span class="op">=</span> <span class="va">data_size</span>,</span></span>
<span class="r-in"><span>  cutoffs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">3</span>, <span class="op">-</span><span class="fl">6</span>, <span class="op">-</span><span class="fl">40</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  vlines <span class="op">=</span> <span class="fl">5</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="design_filter_fir-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ---- Advanced ---------------------------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sample_rate</span> <span class="op">&lt;-</span> <span class="fl">500</span></span></span>
<span class="r-in"><span><span class="va">data_size</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Rejecting 3-8 Hz, with transition bandwidth 0.5 Hz at both ends</span></span></span>
<span class="r-in"><span><span class="co"># Using least-square (firls) to generate FIR filter</span></span></span>
<span class="r-in"><span><span class="co"># Suggesting the filter order n=160</span></span></span>
<span class="r-in"><span><span class="va">filter</span> <span class="op">&lt;-</span> <span class="fu">design_filter_fir</span><span class="op">(</span></span></span>
<span class="r-in"><span>  low_pass_freq <span class="op">=</span> <span class="fl">3</span>, low_pass_trans_freq <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>  high_pass_freq <span class="op">=</span> <span class="fl">8</span>, high_pass_trans_freq <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>  filter_order <span class="op">=</span> <span class="fl">160</span>,</span></span>
<span class="r-in"><span>  sample_rate <span class="op">=</span> <span class="va">sample_rate</span>,</span></span>
<span class="r-in"><span>  data_size <span class="op">=</span> <span class="va">data_size</span>,</span></span>
<span class="r-in"><span>  method <span class="op">=</span> <span class="st">"firls"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">filter</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;FIR filter&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Type : stop</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Method: firls</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Order: 160</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Magnitude:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Freq=3 Hz, mag=-5.137 dB (expected=-0.0873 dB)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Freq=8 Hz, mag=-5.196 dB (expected=-0.0873 dB)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Freq=3.5 Hz, mag=-6.376 dB (expected=-40 dB)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Freq=7.5 Hz, mag=-6.44 dB (expected=-40 dB)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Reciprocal condition number: 1 &gt; .Machine$double.eps</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="diagnose_filter.html">diagnose_filter</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">filter</span><span class="op">$</span><span class="va">b</span>, <span class="va">filter</span><span class="op">$</span><span class="va">a</span>,</span></span>
<span class="r-in"><span>  fs <span class="op">=</span> <span class="va">sample_rate</span>,</span></span>
<span class="r-in"><span>  n <span class="op">=</span> <span class="va">data_size</span>,</span></span>
<span class="r-in"><span>  cutoffs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">40</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  vlines <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">8</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="design_filter_fir-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zhengjia Wang, John Magnotti, Michael Beauchamp.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

