<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Design 'FIR' filter using firls — design_filter_fir • ravetools</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Design 'FIR' filter using firls — design_filter_fir"><meta name="description" content="Design 'FIR' filter using firls"><meta property="og:description" content="Design 'FIR' filter using firls"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ravetools</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.6.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dipterix/ravetools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Design <code>'FIR'</code> filter using <code><a href="firls.html">firls</a></code></h1>
      <small class="dont-index">Source: <a href="https://github.com/dipterix/ravetools/blob/master/R/filter-fir-design.R" class="external-link"><code>R/filter-fir-design.R</code></a></small>
      <div class="d-none name"><code>design_filter_fir.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Design <code>'FIR'</code> filter using <code><a href="firls.html">firls</a></code></p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">design_filter_fir</span><span class="op">(</span></span>
<span>  <span class="va">sample_rate</span>,</span>
<span>  filter_order <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  data_size <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  high_pass_freq <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  high_pass_trans_freq <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  low_pass_freq <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  low_pass_trans_freq <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  trans_attenuation <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-sample-rate">sample_rate<a class="anchor" aria-label="anchor" href="#arg-sample-rate"></a></dt>
<dd><p>sampling frequency</p></dd>


<dt id="arg-filter-order">filter_order<a class="anchor" aria-label="anchor" href="#arg-filter-order"></a></dt>
<dd><p>filter order, leave <code>NA</code> (default) if undecided</p></dd>


<dt id="arg-data-size">data_size<a class="anchor" aria-label="anchor" href="#arg-data-size"></a></dt>
<dd><p>minimum length of data to apply the filter, used to
decide the maximum filter order. For 'FIR' filter, data length must be
greater than <code>3xfilter_order</code></p></dd>


<dt id="arg-high-pass-freq">high_pass_freq<a class="anchor" aria-label="anchor" href="#arg-high-pass-freq"></a></dt>
<dd><p>high-pass frequency; default is <code>0</code> (no high-pass
filter will be applied)</p></dd>


<dt id="arg-high-pass-trans-freq">high_pass_trans_freq<a class="anchor" aria-label="anchor" href="#arg-high-pass-trans-freq"></a></dt>
<dd><p>high-pass frequency band-width; default
is automatically inferred from data size.
Frequency <code>high_pass_freq - high_pass_trans_freq</code> if the cutoff
frequency at power <code>-trans_attenuation</code>; see input
<code>trans_attenuation</code> or run <code>print(design_filter_fir)</code>
for illustration</p></dd>


<dt id="arg-low-pass-freq">low_pass_freq<a class="anchor" aria-label="anchor" href="#arg-low-pass-freq"></a></dt>
<dd><p>low-pass frequency; default is 'Nyquist' frequency (no
low-pass filter will be applied)</p></dd>


<dt id="arg-low-pass-trans-freq">low_pass_trans_freq<a class="anchor" aria-label="anchor" href="#arg-low-pass-trans-freq"></a></dt>
<dd><p>low-pass frequency band-width; default
is automatically inferred from data size.
Frequency <code>low_pass_freq + low_pass_trans_freq</code> if the cutoff
frequency at power <code>-trans_attenuation</code>; see input
<code>trans_attenuation</code> or run <code>print(design_filter_fir)</code> for
illustration</p></dd>


<dt id="arg-trans-attenuation">trans_attenuation<a class="anchor" aria-label="anchor" href="#arg-trans-attenuation"></a></dt>
<dd><p>allowable power attenuation (in decibel) at
transition frequency; default is <code>3</code> dB, which is half power.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Function that generates the 'FIR' filter given filter order</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Filter type is determined from <code>high_pass_freq</code> and
<code>low_pass_freq</code>. High-pass frequency is ignored if <code>high_pass_freq</code>
is less equal to 0, hence the filter is low-pass filter. When
<code>low_pass_freq</code> is greater equal to 'Nyquist' frequency, then
the filter is high-pass filter. When both <code>high_pass_freq</code> and
<code>low_pass_freq</code> are valid (positive, less than 'Nyquist'), then
the filter is a band-pass filter if band-pass is less than low-pass
frequency, otherwise the filter is band-stop.</p>
<p>Although the peak amplitudes are set by <code>low_pass_freq</code> and
<code>high_pass_freq</code>, the transition from peak amplitude to zero require
a transition, which is tricky but also important to set.
When 'FIR' filters have too steep transition boundaries, the filter tends to
have ripples in peak amplitude, introducing artifacts to the final signals.
When the filter is too flat, components from unwanted frequencies may also
get aliased into the filtered signals. Ideally, the transition bandwidth
cannot be too steep nor too flat. In this function, users may control
the transition frequency bandwidths via <code>low_pass_trans_freq</code> and
<code>high_pass_trans_freq</code>. The power at the end of transition is defined
by <code>trans_attenuation</code>, with default value of <code>3</code> (i.e.
-3 dB, this number is automatically negated during the calculation).
By design, a low-pass 5 Hz filter with 1 Hz transition bandwidth results in
attenuating -3 dB power at 6 Hz, and -6 dB at 7 Hz (<code>5 + 1 x 2</code>).
Common choices of <code>trans_attenuation</code> are <code>3</code> (half power at
the transition boundary) and <code>6</code> (half amplitude at the transition
boundary).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># see illustration by `print(design_filter_fir)`</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ---- FIR band-pass example -----------------------------</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sample_rate</span> <span class="op">&lt;-</span> <span class="fl">500</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fir_generator</span> <span class="op">&lt;-</span> <span class="fu">design_filter_fir</span><span class="op">(</span></span></span>
<span class="r-in"><span>  sample_rate <span class="op">=</span> <span class="va">sample_rate</span>,</span></span>
<span class="r-in"><span>  high_pass_freq <span class="op">=</span> <span class="fl">1</span>, high_pass_trans_freq <span class="op">=</span> <span class="fl">0.25</span>,</span></span>
<span class="r-in"><span>  low_pass_freq <span class="op">=</span> <span class="fl">50</span>, low_pass_trans_freq <span class="op">=</span> <span class="fl">6</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># check generator information</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fir_generator</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;RAVE filter generator function&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Filter type : fir (pass)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Filter order: 293 (suggested)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min order: 293 (to achieve transition)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Max order: Inf (restricted by data size)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Input parameters for `firls`: (not actual filter)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Peak frequency: [0.004,0.2] x Nyquist (1.0 Hz~50.0 Hz, -0 dB)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Transition frequency: [0.003,0.224] x Nyquist (0.8 Hz~56.0 Hz, -3 dB)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Stop-band frequency: [0.000576,0.2822] x Nyquist (0.1 Hz~70.5 Hz, -Inf dB)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   The frequency response is (approximately) given by:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      1-|               ----------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        |             /|         | \</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        |            / |         |  \</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        |           /  |         |   \</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  |H|   |          /   |         |    \</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Rpa-|---------/----+---------+-----\</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        |        /|    |         |     |\           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        |       / |    |         |     | \          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        |      /  |    |         |     |  \         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      0-|-----/   |    |         |     |   \--------|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        0    Fs1 Fp1   Fh        Fl   Fp2  Fs2       Nyq</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Where:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       * Nyq:      (Nyquist) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             = `sample_rate` / 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       * Rpa:      (Transition power attenuation converted to amplitude) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             = 10 ^ { - `trans_attenuation` / 20 }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       * Fh:       (High-pass frequency) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             = `high_pass_freq`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       * Fl:       (Low-pass frequency) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             = `low_pass_freq`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       * Fp1, Fp2: (Transition frequency)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Fp1 = Fh - `high_pass_trans_freq`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Fp2 = Fl + `low_pass_trans_freq`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       * Fs1, Fs2: (Stop-band frequency, auto-derived)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Generator Function Definition:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   function(data, order = NULL, window = hamming, scale = TRUE, hilbert = FALSE) { ... }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Arguments:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - `data`   : (optional) data to be filtered</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - `order`  : (optional) Integer(1) filter order if not default</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - `window` : (optional) Function(1) or `NULL`, function for the `FIR` window; default is `hamming`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - `scale`  : (optional) Logical(1) whether to scale the filter for unity gain; default is `TRUE`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - `hilbert`: (optional) Logical(1) use hilbert transform; default is `FALSE`.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Values: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Filtered data if `data` is provided (using `filtfilt`); otherwise will be the filter.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">filter</span> <span class="op">&lt;-</span> <span class="fu">fir_generator</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># -3dB cutoff (50% power) should be roughly within</span></span></span>
<span class="r-in"><span><span class="co"># 0.75 (=1-0.25) ~ 56 (=50+6) Hz</span></span></span>
<span class="r-in"><span><span class="fu"><a href="diagnose_filter.html">diagnose_filter</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">filter</span><span class="op">$</span><span class="va">b</span>, <span class="va">filter</span><span class="op">$</span><span class="va">a</span>,</span></span>
<span class="r-in"><span>  fs <span class="op">=</span> <span class="va">sample_rate</span>,</span></span>
<span class="r-in"><span>  n <span class="op">=</span> <span class="fl">1000</span>,</span></span>
<span class="r-in"><span>  vlines <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="design_filter_fir-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ---- High-pass filter with auto bandwith from data -----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sample_rate</span> <span class="op">&lt;-</span> <span class="fl">500</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fir_generator</span> <span class="op">&lt;-</span> <span class="fu">design_filter_fir</span><span class="op">(</span></span></span>
<span class="r-in"><span>  sample_rate <span class="op">=</span> <span class="va">sample_rate</span>,</span></span>
<span class="r-in"><span>  data_size <span class="op">=</span> <span class="fl">1000</span>,</span></span>
<span class="r-in"><span>  high_pass_freq <span class="op">=</span> <span class="fl">6</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fir_generator</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;RAVE filter generator function&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Filter type : fir (high)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Filter order: 333 (suggested)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min order: 333 (to achieve transition)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Max order: 333 (restricted by data size)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Input parameters for `firls`: (not actual filter)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Peak frequency: [0.024] x Nyquist (6.0 Hz, -0 dB)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Transition frequency: [0.02312] x Nyquist (5.8 Hz, -3 dB)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Stop-band frequency: [0.02099] x Nyquist (5.2 Hz, -Inf dB)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   The frequency response is (approximately) given by:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      1-|               -----------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        |             / |         |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Rpa-|------------/  |         |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  |H|   |           /|  |         |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        |          / |  |         |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      0-|----------  |  |         |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        |         |  |  |         |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        0        Fs  Fp Fh        Nyq</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Where:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       * Nyq:      (Nyquist) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             = `sample_rate` / 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       * Rpa:      (Transition power attenuation converted to amplitude) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             = 10 ^ { - `trans_attenuation` / 20 }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       * Fh:       (High-pass frequency) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             = `high_pass_freq`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       * Fp:       (Transition frequency)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             = Fh - `high_pass_trans_freq`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       * Fs:       (Stop-band frequency, auto-derived)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Generator Function Definition:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   function(data, order = NULL, window = hamming, scale = TRUE, hilbert = FALSE) { ... }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Arguments:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - `data`   : (optional) data to be filtered</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - `order`  : (optional) Integer(1) filter order if not default</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - `window` : (optional) Function(1) or `NULL`, function for the `FIR` window; default is `hamming`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - `scale`  : (optional) Logical(1) whether to scale the filter for unity gain; default is `TRUE`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - `hilbert`: (optional) Logical(1) use hilbert transform; default is `FALSE`.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Values: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Filtered data if `data` is provided (using `filtfilt`); otherwise will be the filter.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">filter</span> <span class="op">&lt;-</span> <span class="fu">fir_generator</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># -3dB cutoff should cover 6 Hz to Nyquist frequency</span></span></span>
<span class="r-in"><span><span class="fu"><a href="diagnose_filter.html">diagnose_filter</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">filter</span><span class="op">$</span><span class="va">b</span>, <span class="va">filter</span><span class="op">$</span><span class="va">a</span>,</span></span>
<span class="r-in"><span>  fs <span class="op">=</span> <span class="va">sample_rate</span>,</span></span>
<span class="r-in"><span>  n <span class="op">=</span> <span class="fl">1000</span>,</span></span>
<span class="r-in"><span>  vlines <span class="op">=</span> <span class="fl">6</span>,</span></span>
<span class="r-in"><span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="design_filter_fir-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ---- Low-pass filter with auto bandwith from filter order -----</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">sample_rate</span> <span class="op">&lt;-</span> <span class="fl">500</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fir_generator</span> <span class="op">&lt;-</span> <span class="fu">design_filter_fir</span><span class="op">(</span></span></span>
<span class="r-in"><span>  sample_rate <span class="op">=</span> <span class="va">sample_rate</span>,</span></span>
<span class="r-in"><span>  filter_order <span class="op">=</span> <span class="fl">200</span>,</span></span>
<span class="r-in"><span>  low_pass_freq <span class="op">=</span> <span class="fl">6</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fir_generator</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;RAVE filter generator function&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Filter type : fir (low)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Filter order: 200 (suggested)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min order: 200 (to achieve transition)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Max order: Inf (restricted by data size)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Input parameters for `firls`: (not actual filter)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Peak frequency: [0.024] x Nyquist (6.0 Hz, -0 dB)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Transition frequency: [0.02547] x Nyquist (6.4 Hz, -3 dB)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Stop-band frequency: [0.02903] x Nyquist (7.3 Hz, -Inf dB)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   The frequency response is (approximately) given by:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      1-|---------              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  |H|   |       | \            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Rpa-|-------+--\           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        |       |  |\          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        |       |  | \         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      0-|-------|  |  ----------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        |       |  |  |        |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        0       Fl Fp Fs       Nyq</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Where:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       * Nyq:      (Nyquist) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             = `sample_rate` / 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       * Rpa:      (Transition power attenuation converted to amplitude) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             = 10 ^ { - `trans_attenuation` / 20 }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       * Fl:       (Low-pass frequency) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             = `low_pass_freq`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       * Fp:       (Transition frequency)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             = Fl + `low_pass_trans_freq`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       * Fs:       (Stop-band frequency, auto-derived)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Generator Function Definition:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   function(data, order = NULL, window = hamming, scale = TRUE, hilbert = FALSE) { ... }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Arguments:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - `data`   : (optional) data to be filtered</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - `order`  : (optional) Integer(1) filter order if not default</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - `window` : (optional) Function(1) or `NULL`, function for the `FIR` window; default is `hamming`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - `scale`  : (optional) Logical(1) whether to scale the filter for unity gain; default is `TRUE`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - `hilbert`: (optional) Logical(1) use hilbert transform; default is `FALSE`.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Values: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Filtered data if `data` is provided (using `filtfilt`); otherwise will be the filter.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">filter</span> <span class="op">&lt;-</span> <span class="fu">fir_generator</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># -3dB cutoff should cover 0-6 Hz</span></span></span>
<span class="r-in"><span><span class="fu"><a href="diagnose_filter.html">diagnose_filter</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">filter</span><span class="op">$</span><span class="va">b</span>, <span class="va">filter</span><span class="op">$</span><span class="va">a</span>,</span></span>
<span class="r-in"><span>  fs <span class="op">=</span> <span class="va">sample_rate</span>,</span></span>
<span class="r-in"><span>  n <span class="op">=</span> <span class="fl">1000</span>,</span></span>
<span class="r-in"><span>  vlines <span class="op">=</span> <span class="fl">6</span>,</span></span>
<span class="r-in"><span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="design_filter_fir-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ---- Band-stop filter when data size is small -----</span></span></span>
<span class="r-in"><span><span class="va">sample_rate</span> <span class="op">&lt;-</span> <span class="fl">500</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># cannot have too sharp transition</span></span></span>
<span class="r-in"><span><span class="va">fir_generator</span> <span class="op">&lt;-</span> <span class="fu">design_filter_fir</span><span class="op">(</span></span></span>
<span class="r-in"><span>  sample_rate <span class="op">=</span> <span class="va">sample_rate</span>,</span></span>
<span class="r-in"><span>  filter_order <span class="op">=</span> <span class="fl">200</span>,</span></span>
<span class="r-in"><span>  low_pass_freq <span class="op">=</span> <span class="fl">6</span>,</span></span>
<span class="r-in"><span>  high_pass_freq <span class="op">=</span> <span class="fl">8</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fir_generator</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;RAVE filter generator function&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Filter type : fir (stop)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Filter order: 200 (suggested)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min order: 280 (to achieve transition)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Max order: Inf (restricted by data size)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Input parameters for `firls`: (not actual filter)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Peak frequency: [0.032,0.024] x Nyquist (8.0 Hz~6.0 Hz, -0 dB)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Transition frequency: [0.03053,0.02547] x Nyquist (7.6 Hz~6.4 Hz, -3 dB)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Stop-band frequency: [0.028,0.028] x Nyquist (7.0 Hz~7.0 Hz, -Inf dB)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   The frequency response is (approximately) given by:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      1-|---------                  ----------|</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        |       | \                / |       |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    |H| |       |  \              /  |       |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Rpa-|-------+--|\------------/|  |       |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        |       |  | \          / |  |       |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      0-|-------|  |  ----------  |  |       |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        |       |  |  |        |  |  |       |</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        0      Fl Fp2 Fs2    Fs1 Fp1 Fh     Nyq</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Where:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       * Nyq:      (Nyquist) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             = `sample_rate` / 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       * Rpa:      (Transition power attenuation converted to amplitude) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             = 10 ^ { - `trans_attenuation` / 20 }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       * Fh:       (High-pass frequency) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             = `high_pass_freq`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       * Fl:       (Low-pass frequency) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             = `low_pass_freq`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       * Fp1, Fp2: (Transition frequency)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Fp1 = Fh - `high_pass_trans_freq`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Fp2 = Fl + `low_pass_trans_freq`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       * Fs1, Fs2: (Stop-band frequency, auto-derived)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Generator Function Definition:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   function(data, order = NULL, window = hamming, scale = TRUE, hilbert = FALSE) { ... }</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Arguments:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - `data`   : (optional) data to be filtered</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - `order`  : (optional) Integer(1) filter order if not default</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - `window` : (optional) Function(1) or `NULL`, function for the `FIR` window; default is `hamming`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - `scale`  : (optional) Logical(1) whether to scale the filter for unity gain; default is `TRUE`</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   - `hilbert`: (optional) Logical(1) use hilbert transform; default is `FALSE`.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Values: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Filtered data if `data` is provided (using `filtfilt`); otherwise will be the filter.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">filter</span> <span class="op">&lt;-</span> <span class="fu">fir_generator</span><span class="op">(</span>scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># -3dB cutoff should cover 0-6 Hz &amp; 8-Nyquist</span></span></span>
<span class="r-in"><span><span class="fu"><a href="diagnose_filter.html">diagnose_filter</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">filter</span><span class="op">$</span><span class="va">b</span>, <span class="va">filter</span><span class="op">$</span><span class="va">a</span>,</span></span>
<span class="r-in"><span>  fs <span class="op">=</span> <span class="va">sample_rate</span>,</span></span>
<span class="r-in"><span>  n <span class="op">=</span> <span class="fl">1000</span>,</span></span>
<span class="r-in"><span>  vlines <span class="op">=</span> <span class="fl">6</span>,</span></span>
<span class="r-in"><span>  xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="design_filter_fir-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Zhengjia Wang, John Magnotti, Michael Beauchamp.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

